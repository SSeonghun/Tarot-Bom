<!DOCTYPE html><html><head>
    <title>WebSocket Chat</title></head><body>
<div>
    <h2>Chat</h2>
    <div id="chat">
        <div id="messages"></div>
        <input type="text" id="messageInput" placeholder="Type a message...">
        <button onclick="sendMessage()">Send</button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/sockjs/1.1.4/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs/lib/stomp.min.js"></script>
<script>
    let stompClient = null;

    function connect() {
        const socket = new SockJS('/ws-stomp');
        stompClient = Stomp.over(socket);
        stompClient.connect({}, onConnected, onError);
    }

    function onConnected() {
        stompClient.subscribe('/sub/public', onMessageReceived);
    }

    function onError(error) {
        console.log('Error ' + error);
    }

    function sendMessage() {
        const messageInput = document.getElementById('messageInput');
        const messageContent = messageInput.value.trim();

        if (messageContent && stompClient) {
            const chatMessage = {
                messageType: 'TALK',
                roomId : "35de8991-8758-4ca5-9ade-a21deabb6fd6",
                senderId: 2,
                message : messageContent
            };
            stompClient.send("/pub/chat.sendMessage", {}, JSON.stringify(chatMessage));
            messageInput.value = '';
        }
    }

    function onMessageReceived(payload) {
        const message = JSON.parse(payload.body);
        const messageElement = document.createElement('div');
        messageElement.classList.add('message');

        const textElement = document.createElement('p');
        textElement.textContent = message.sender + ": " + message.content;
        messageElement.appendChild(textElement);

        const chat = document.getElementById('messages');
        chat.appendChild(messageElement);
        chat.scrollTop = chat.scrollHeight;
    }

    window.onload = function() {
        connect();

        // Simulate two users chatting
        setInterval(function() {
            const messageInput = document.getElementById('messageInput');
            messageInput.value = "Hello from User2";
            sendMessage();
        }, 5000); // Change the interval as needed
    };
</script></body></html>